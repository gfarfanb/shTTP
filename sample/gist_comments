#! /usr/bin/env bash
#  -author Giovanni Farf√°n B.

before_api() {
    basePath "/gists/$( get gistId )/comments"
    headers \
        "User-Agent: $( get appName )" \
        "Accept: application/vnd.github.$( get apiVersion ).full+json" \
        "Content-Type: application/vnd.github.$( get apiVersion ).full+json"
}

get_all() {
    :
}

get_comment() {
    endpoint "/$( get commentId )"
}

before_post_comment() {
    credential sample
    authMode HEADER
}

post_comment() {
    body '{ "body": "shTTP-samples comment" }'
}

after_post_comment() {
    areEquals "Unexpected status" "201" "$( getStatus )"
    isNotNull "Comment ID not found" "$( getOutput id )"
    put commentId '.id'
}

# ./gist_comment patch_comment --auth-header sample
patch_comment() {
    endpoint "/$( get commentId )"
    body '{ "body": "shTTP-samples comment update" }'
}

after_patch_comment() {
    areEquals "Unexpected status" "200" "$( getStatus )"
}

# ./gist_comment delete_comment --auth-header sample
delete_comment() {
    endpoint "/$( get commentId )"
}

after_delete_comment() {
    areEquals "Unexpected status" "204" "$( getStatus )"
    remove commentId
}

after_api() {
    :
}

# ./gist_comment flow_comment --auth-header sample
flow_comment() {
    step post_comment # Internally has defined credential and auth mode
    step patch_comment --auth-header sample # Explicit credential ans auth mode definition
    step delete_comment # Inherit credential and auth mode
}

#  shellcheck disable=SC1091
. ../http_api
