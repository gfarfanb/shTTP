#  Assert functions for unit tests.
#  This is imported by 'test_runner'.
#  Functions '_fail' and '_inc_asserts'
#+ are visible because 'test_runner'.

fail() {
    _fail "$*"
    _inc_asserts
}

assertTrue() {
    local _message=${1:-''}
    local _condition=${2:-''}
    local _ok=1
    eval "if ! [ $_condition ]; then _ok=0 ; fi"
    if [ $_ok = 0 ]; then
        _fail "[ $_condition ]: $_message"
    fi
    _inc_asserts
}

assertFalse() {
    local _message=${1:-''}
    local _condition=${2:-''}
    local _ok=1
    eval "if [ $_condition ]; then _ok=0 ; fi"
    if [ $_ok = 0 ]; then
        _fail "! [ $_condition ]: $_message"
    fi
    _inc_asserts
}

assertEquals() {
    local _message=${1:-''}
    local _expected=${2:-''}
    local _input=${3:-''}
    local _ok=1
    if [ "$_expected" != "$_input" ]; then
        _fail "[ "$_expected" = "$_input" ]: $_message"
    fi
    _assertions=$(( _assertions+1 ))
}

assertNotEquals() {
    local _message=${1:-''}
    local _expected=${2:-''}
    local _input=${3:-''}
    local _ok=1
    if [ "$_expected" = "$_input" ]; then
        _fail "[ "$_expected" != "$_input" ]: $_message"
    fi
    _inc_asserts
}
